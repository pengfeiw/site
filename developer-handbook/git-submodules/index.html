<html lang="zh_cn"><head><title></title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Git,命令,cli,command"><meta name="description" content="Git submodule 功能可以让我们在一个仓库中添加另一个仓库作为当前仓库的子仓库。Git submodules 只是某个仓库某一时刻的一个状态的引用，即某个 commit 的引用。"><link rel="stylesheet" href="/assests/code_github.css"><link rel="stylesheet" href="/assests/github_markdown.css"><link rel="stylesheet" href="/assests/article.css"><link rel="stylesheet" href="/assests/navigator.css"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/rss.xml"><img src="/assests/images/rss.png" alt="rss"></a></div></div></div><h1><a href="/"><img src="https://avatars.githubusercontent.com/u/37898750?s=400&amp;u=33f96e0bbc5bee7a7d1fa8f1eecee9a3d4a6d96c&amp;v=4"></a></h1></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2022年6月12日</span><span class="category"><a href="/developer-handbook">标签：Developer</a></span></div><div class="markdown-body"><h1 id="Git Submodules">Git Submodules <a href="#Git Submodules">#</a></h1><p><em>Git submodule 功能可以让我们在一个仓库中添加另一个仓库作为当前仓库的子仓库。Git submodules 只是某个仓库某一时刻的一个状态的引用，即某个 commit 的引用。</em></p><h2 id="介绍">介绍 <a href="#介绍">#</a></h2><p>开发一个复杂的项目时，通常需要依赖一些外部的代码包，这样既方便了代码管理，也免去我们重复造轮子的精力和时间。</p><p>依赖外部代码通常有两种方式：</p><ul><li>直接将外部代码拷贝到当前项目源码中，这种方式是最不建议的方式，因为它丢弃了外部代码之前的 git 版本信息，而且拷贝容易出错，可能造成功能的缺失，导致 bug 的产生。</li><li>另一种方式是依靠各种编程语言的 package manager，例如 npm、NuGut，这种方式是目前最流行使用也是最多的。使用这种方式的缺点就是，你需要对 package 进行各种版本管理，如果在依赖的 package 里发现 bug，或者新增功能，你都需要在每次更新后重新发布 package。</li></ul><p>所以，如果你在一个复杂的项目里需要依赖一个外部的 package，并且你<strong>需要频繁更新这个 package</strong>，那么你可以使用 Git submodules 的功能。</p><p><strong>git submodule 是某个 git 仓库的某个 commit 的引用，它并不会追踪仓库的具体分支。在仓库中添加一个 submodule，会自动创建一个 <code>.gitsubmodules</code> 文件，该文件包含了所有子模块的信息——子模块项目地址、子模块在当前仓库中的代码位置。</strong></p><h2 id="使用">使用 <a href="#使用">#</a></h2><h3 id="1.添加子模块">1.添加子模块 <a href="#1.添加子模块">#</a></h3><p>使用 <code>git submodule add &lt;submodule_url&gt;</code> 命令添加子模块。</p><pre><code class="hljs language-bash">$ git submodule add https://bitbucket.org/jaredw/awesomelibrary
Cloning into <span class="hljs-string">'/Users/atlassian/git-submodule-demo/awesomelibrary'</span>...
remote: Counting objects: 8, <span class="hljs-keyword">done</span>.
remote: Compressing objects: 100% (6/6), <span class="hljs-keyword">done</span>.
remote: Total 8 (delta 1), reused 0 (delta 0)
Unpacking objects: 100% (8/8), <span class="hljs-keyword">done</span>.
</code></pre><p>添加子模块后，可以使用 <code>git status</code> 查看仓库状态，在仓库中多了一个 <code>.gitmodules</code> 文件和 <code>awesomelibrary</code> 文件夹。</p><pre><code class="hljs language-bash">$ git status
On branch main

No commits yet

Changes to be committed:
  (use <span class="hljs-string">"git rm --cached &lt;file&gt;..."</span> to unstage)

 new file:   .gitmodules
 new file:   awesomelibrary
</code></pre><p>查看 <code>.gitmodules</code> 文件内容。</p><pre><code class="hljs language-bash">[submodule <span class="hljs-string">"awesomelibrary"</span>]
 path = awesomelibrary
 url = https://bitbucket.org/jaredw/awesomelibrary
</code></pre><ul><li>path 指定了子模块在当前仓库中所在的位置</li><li>url 指定了子模块的仓库位置</li></ul><h3 id="2.子模块初始化和更新">2.子模块初始化和更新 <a href="#2.子模块初始化和更新">#</a></h3><p>当你克隆了一个包含 submodules 的 git 仓库，使用 <code>git clone</code> 命令并不会拉取子模块的代码，克隆下来的仓库中的子模块文件夹都是空的，所有的<strong>子模块必须先初始化然后更新</strong>。</p><p>可以使用 <code>git submodule init [&lt;submodule_name&gt; ...]</code> 命令初始化子仓库，它的作用是将 <code>.gitmodules</code> 文件中的子模块信息拷贝到当前仓库的 <code>./.git/config</code> 配置文件中，乍一看这一步骤似乎是多余的，因为 <code>.gitmodules</code> 已经包含了子模块的信息，为什么还要多此一举呢？其实，这并不是一个多余的步骤，假设当前仓库包含了很多子模块，但是此时你开发的工作并不需要全部的子模块代码，所以你可以指定初始化你需要的子模块，然后再拉取代码。</p><pre><code class="hljs language-bash">$ git submodule init
Submodule <span class="hljs-string">'awesomelibrary'</span> (https://bitbucket.org/jaredw/awesomelibrary) registered <span class="hljs-keyword">for</span> path <span class="hljs-string">'awesomelibrary'</span>
</code></pre><p>当子模块初始化后，可以使用 <code>git submodule udpate</code> 命令拉取子模块的代码。</p><pre><code class="hljs language-bash">$ git submodule update
Cloning into <span class="hljs-string">'awesomelibrary'</span>...
remote: Counting objects: 11, <span class="hljs-keyword">done</span>.
remote: Compressing objects: 100% (10/10), <span class="hljs-keyword">done</span>.
remote: Total 11 (delta 0), reused 11 (delta 0)
Unpacking objects: 100% (11/11), <span class="hljs-keyword">done</span>.
Checking connectivity... <span class="hljs-keyword">done</span>.
Submodule path <span class="hljs-string">'awesomelibrary'</span>: checked out <span class="hljs-string">'c3f01dc8862123d317dd46284b05b6892c7b29bc'</span>
</code></pre><p>更新后，再次检查 <code>./awesomelibrary</code> 文件夹，发现它不再是一个空的文件夹了，可以使用 <code>git submodule init &amp;&amp; git submodule update</code> 将两个命令合并成一个。</p><p>这里有一个技巧，当存在嵌套模块时，子模块包含子模块的情况，可以使用 <code>git submodule update --init --recursive</code>，循环初始化和更新所有子模块（包含嵌套子模块）。</p><h3 id="3.子模块工作流程">3.子模块工作流程 <a href="#3.子模块工作流程">#</a></h3><p>子模块有自己独立的版本管理。还记得前面说过的吗？仓库中的子模块引用的仅仅是子模块中的一个 commit，而不是一个 branch。所以当子模块发生更新后，我们必须在父仓库中更新一下子模块的引用，将其指向子模块中新的 commit。这意味着你在子模块中的更新，需要两次 add 和 commit 操作，一次是子模块自己的 add、commit，还有一次是为了在父模块中更新子模块引用，这是一个比较麻烦的一点，也是我一直厌恶的一点，但没有办法，机制就是这样，既然无法改变，那只有接受。</p><p>参考资料：</p><ul><li><a href="https://www.atlassian.com/git/tutorials/git-submodule">Bitbucket git submodules</a></li><li><a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">git 官方文档</a></li></ul><p>(完)</p></div><div class="markdown-footer"><span class="pre-article"><a href="/javascript/eslint-tutorial">上一篇：ESLint 教程</a></span><span class="next-article"><a href="/developer-handbook/uml">下一篇：UML 类图</a></span></div></div></body></html>