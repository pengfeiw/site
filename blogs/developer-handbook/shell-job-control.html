<html lang="zh_cn"><head><title>Shell 中的工作控制</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="background-job,foreground-job,linux,shell,bash"><meta name="description" content="了解 shell 中的工作控制background job 和 foreground job，以及它们之间如何切换"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><link rel="icon" href="/blogs/assests/images/icon.jpg"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="email"><a href="mailto:pengfeixc@sina.com">Email</a></div><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.svg" alt="rss"></a></div></div></div><a href="/blogs/"><img src="/blogs/assests/images/icon.jpg"></a></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2022年11月27日</span><span class="category"><a href="/blogs/developer-handbook">标签：Developer</a></span></div><div class="markdown-body"><h1 id="Shell 中的工作控制">Shell 中的工作控制 <a href="#Shell 中的工作控制">#</a></h1><p>很多 command 执行后，会一直运行并不会立即结束，它们会一直占据命令行，导致不会出现下一个 prompt。例如使用 python 启动 server：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">python -m http.server</span>
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</code></pre><p>如果用户想继续使用命令行就必须新开一个命令行窗口。那么有没有其他的方式可以使这些不会立即结束的命令在后台运行呢？</p><h2 id="Foreground 和 Background">Foreground 和 Background <a href="#Foreground 和 Background">#</a></h2><p>1）以后台进程启动命令</p><p>可以将工作转换成后台工作（background job），在运行的命令行后添加 <code>&amp;</code> 将启动命令为 background job。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">python -m http.server &amp;</span>
[2] 910
</code></pre><p>2）显示 background job 列表</p><p>使用 <code>jobs</code> 可以查看当前已有的后台工作。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">jobs</span></span>
[1]   Running                 python3 -m http.server 3000 &amp;
[2]-  Running                 python3 -m http.server &amp;
[3]+  Running                 python3 -m http.server 3100 &amp;
</code></pre><p>第一列的数字表示后台工作的 id，第二列表示当前的状态（Running 或者 Stopped），最后表示启动的命令详情。</p><p>3）将已经启动的程序移动到后台继续运行</p><p>如果一个程序已经在运行了，那么你可能会执行 <code>^ + C</code> （windows 中输入 <code>ctrl + C</code>）终止程序，然后重新以 background job 形式执行这个程序。但是如果你正在下载一个非常大的文件，如果终止了，那么就需要重新下载，更好的做法是将已经运行的程序移动到后台继续运行。</p><p>我们可以使用 <code>^ + Z</code> 将程序移动到后台，并进入暂停状态：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">python -m http.server 3100</span>
Serving HTTP on 0.0.0.0 port 3100 (http://0.0.0.0:3100/) ...
^Z
[3]+  Stopped                 python3 -m http.server 3100
</code></pre><p>可以从上面的 shell 输出信息看到上面的程序 id 为 3，并且状态为 <code>Stopped</code>。然后通过 <code>bg %3</code> 可以使 id 为3的暂停的后台进程进入运行状态。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">bg</span> %3</span>
[3]+ python3 -m http.server 3100 &amp;
</code></pre><p>4）background 转换为 foreground</p><p>使用 <code>fg %1</code> 可以使 id 为 1 的后台工作变成前台工作。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">fg</span> %1</span>
python3 -m http.server 3000
</code></pre><p>5）终止后台进程</p><p>使用 <code>kill %2</code> 可以终止 id 为 2 的后台工作。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">kill</span> %2</span>
[2]-  Terminated              python3 -m http.server
</code></pre><h2 id="分屏会更好">分屏会更好 <a href="#分屏会更好">#</a></h2><p>现在的 terminal 很多都支持分屏，我目前在 windows 上使用的 windows terminal 也支持分屏操作，所以无需将工作移到后台运行，如果需要执行另一个命令直接重启一个分屏即可。所以更推荐使用分屏，而不是 background jobs。</p><p>还有 screen 和 tmux 可以使 shell 支持分屏的能力。</p><h2 id="参考资料">参考资料 <a href="#参考资料">#</a></h2><p>推荐一本非常棒的 shell 学习教程：<a href="https://effective-shell.com/">Effective Shell</a>。</p><p>（完）</p></div><div class="markdown-footer"><span class="pre-article"><a href="/blogs/developer-handbook/communication-between-iframe-and-parent">上一篇：iframe 和 父窗口之间的通信</a></span><span class="next-article"><a href="/blogs/developer-handbook/pipelines-in-shell">下一篇：Pipelines in Shell</a></span></div></div></body></html>