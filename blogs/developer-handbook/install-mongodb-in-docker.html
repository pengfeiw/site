<html lang="zh_cn"><head><title>Docker 中运行 Mongo | 王鹏飞</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="docker,mongodb"><meta name="description" content="Docker 实践，如何在 Docker 中安装并运行 mongodb"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"><link rel="icon" href="/blogs/assests/images/icon.jpg"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="home"><a href="/blogs">Home</a></div><div class="email"><a href="mailto:pengfeixc@sina.com">Email</a></div><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.svg" alt="rss"></a></div></div></div></div><div class="body"><div class="nothing"></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2022年10月8日</span><span class="category"><a href="/blogs/developer-handbook">标签：Developer</a></span></div><div class="markdown-body"><h1 id="在 Docker 中运行 Mongodb">在 Docker 中运行 Mongodb <a href="#在 Docker 中运行 Mongodb">#</a></h1><p>本篇内容，详细介绍如何在 docker 中运行 mongo 的，我用的是 wsl ubuntu 20.04。文章中用到了较多的 docker 命令以及概念，如果想了解 docker 的具体内容可以参考这篇教程：<a href="https://pengfeixc.com/tutorial/docker/docker-guide">Docker 教程</a>。</p><h2 id="安装 docker">安装 docker <a href="#安装 docker">#</a></h2><p>（已经安装了 docker，可以跳过此步骤...）</p><p>ubuntu 可以参考这篇教程安装：<a href="https://docs.docker.com/engine/install/ubuntu/">Install Docker Engine on Ubuntu</a>。</p><p>查看 docker 的版本：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker --version</span>
[sudo] password for pengfei:
Docker version 20.10.18, build b40c2f6
</code></pre><h2 id="下载,运行 mongo 镜像">下载,运行 mongo 镜像 <a href="#下载,运行 mongo 镜像">#</a></h2><p>1）在 <a href="https://hub.docker.com/_/mongo?tab=tags&amp;page=1">docker hub</a> 中下载 mongo 镜像：</p><pre><code class="hljs language-shell">sudo docker pull mongo
</code></pre><blockquote><p>什么是 docker 镜像（docker image）：<a href="https://pengfeixc.com/tutorial/docker/docker-image">https://pengfeixc.com/tutorial/docker/docker-image</a></p></blockquote><p>2）确保安装了 mongo 镜像</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker images</span>
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
mongo         latest    1cca5cf68239   2 days ago      695MB
hello-world   latest    feb5d9fea6a5   12 months ago   13.3kB
</code></pre><p>3）创建 docker 容器</p><p>使用下载的 <code>mongo</code> 镜像创建容器，并释放 27017 端口，这样我们可以通过本机的 27017 端口访问运行的 mongo 数据库服务，<code>--name</code> 指示要启动的容器名称。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker run -p 27017:27017 --name mongodb -d mongo</span>
</code></pre><p>启动 mongodb 后，本机可以使用 <a href="https://studio3t.com/">studio 3T</a> 等数据库可视化客户端，连接到 <code>localhost:27017</code> 来连接数据库。</p><p>查看正在运行的 docker 容器：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                           NAMES
a05a1533b628   mongo     "docker-entrypoint.s…"   17 minutes ago   Up 17 minutes   0.0.0.0:27017-&gt;27017/tcp, :::27017-&gt;27017/tcp   mongodb
</code></pre><p>可以看到 mongodb 容器正在运行。</p><p>停止 mongo 容器运行：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker stop mongodb</span>
mongodb
</code></pre><p>查看所有容器，包括未停止运行的容器，可以看到 <code>STATUS</code> 为 <code>exited</code>：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker ps -a</span>
CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS                      PORTS     NAMES
a05a1533b628   mongo         "docker-entrypoint.s…"   22 minutes ago   Exited (0) 47 seconds ago             mongodb
849405137c9e   hello-world   "/hello"                 46 minutes ago   Exited (0) 46 minutes ago             wizardly_neumann
</code></pre><p>重新启动容器：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker start mongodb</span>
mongodb
</code></pre><blockquote><p>关于 docker 容器的操作，可以参考这篇教程：<a href="https://pengfeixc.com/tutorial/docker/docker-containers">Docker Containers</a></p></blockquote><p>4）使用 volume 持久化数据</p><p>虽然成功启动了 mongodb，但每次停止容器后，docker 容器里面的数据都会消失，可以通过 volume 来保存数据，这样下次重新启动容器后，数据可以得以恢复，不会丢失。</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker run -it -v mongo_volume:/data/db/mongo -p 27017:27017 --name mongodb -d mongo</span>
a05a1533b6280d95fb625213c579228c627ace989f7b00ba1815b8e81f6c815b
</code></pre><p>通过 <code>-v</code> 指令，可以创建并关联 volume，这里 volume 的名称为 <code>mongo_volume</code>，数据存储的位置为 <code>/data/db/mongo</code>。</p><p>查看所有 volume：</p><pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo docker volume <span class="hljs-built_in">ls</span></span>
DRIVER    VOLUME NAME
local     9cf22727a49818b76240fcfd16f0f017a46075974d84cca7b680d03022b1e605
local     58ee5403f72d36bc066757f3a4dc25867046d02acc7e6e69b52bfa530cbabb68
local     24553a91d0eafd60a73f23a65c0f463cb61cbf557ea64ab43d5b784d8a9622d9
local     b8783d382ad0f423ec3064d94401a968ab08f1c766a71f05cdaa17e5e384efc9
local     bffb4d18d9398a92711c3b121c327884e2b2f12ec175dbbb0d7611f526f6747c
local     d38c59edc35c306d7c3be775443b13d2dd7b925d56ad1c72ad3267dfb1b05842
local     mongo_volume
</code></pre><blockquote><p>什么是 volume，如何利用 volume？可以看这篇文章：<a href="https://pengfeixc.com/tutorial/docker/docker-volumes">Docker Volumes</a></p></blockquote><p>国庆假期结束了，又要努力搬砖了...</p><p>如果文章有什么问题，欢迎留言...</p><p>（完）</p></div><div class="markdown-footer"><span class="pre-article"><a href="/blogs/developer-handbook/vimrc">上一篇：自用 .vimrc</a></span><span class="next-article"><a href="/blogs/javascript/rollup-with-typescript">下一篇：使用 rollup 和 typescript 配置项目</a></span></div></div><div class="toc"><div class="toc-header">目录</div><div class="toc-body"><div class="toc-item"><a class="toc-item-link" href="#在 Docker 中运行 Mongodb" style="padding-left:15px">在 Docker 中运行 Mongodb</a></div><div class="toc-item"><a class="toc-item-link" href="#安装 docker" style="padding-left:30px">安装 docker</a></div><div class="toc-item"><a class="toc-item-link" href="#下载,运行 mongo 镜像" style="padding-left:30px">下载,运行 mongo 镜像</a></div></div></div></div></body></html>