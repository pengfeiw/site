<html lang="zh_cn"><head><title>3D图形学中的矩阵变换（一） | 王鹏飞</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords"><meta name="description" content="讲述并证明几何变换中常用的矩阵：缩放矩阵、平移矩阵和旋转矩阵。并说明绕任意轴旋转的矩阵的证明思想。"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><link rel="icon" href="/blogs/assests/images/icon.jpg"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="home"><a href="/blogs">Home</a></div><div class="email"><a href="mailto:pengfeixc@sina.com">Email</a></div><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.svg" alt="rss"></a></div></div></div></div><div class="body"><div class="nothing"></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2021年5月21日</span><span class="category"><a href="/blogs/computer-graphics">标签：ComputerGraphics</a></span></div><div class="markdown-body"><h1 id="3D图形学中的矩阵变换（一）">3D图形学中的矩阵变换（一） <a href="#3D图形学中的矩阵变换（一）">#</a></h1><p>从这个月开始，我打算系统的去学习计算机图形学的知识了，一方面是因为兴趣，另一方面是之前自己也写过一些二维图形相关的程序，有一些数学的基础。图形学在软件开发中的地位很高，市面上所有的建模软件都与图形学相关，即使是photoshop这种设计软件也会涉及图形学的知识。而现在由于webgl的发展，未来图形软件在浏览器的比重也会越来越大。 废话不多说了，直接进入正题。本篇文章主要是为了证明图形学中的几种变换矩阵。首先要知道到学习图形学肯定要与向量、矩阵打交道。如果对线性代数不熟，可以先系统的学习下线性代数，要看懂本篇文章，至少你要有矩阵和向量的基础，会矩阵的数乘和乘法。</p><h3 id="一. 点和向量">一. 点和向量 <a href="#一. 点和向量">#</a></h3><p>这部分我先简单的介绍下点和向量等基础概念。</p><p>平面中任意一个点可以用一个二元数列表示，在笛卡尔坐标系中(0, 0)点表示原点，(1, 1)表示原点往x轴方向移动1步，往y轴方向移动1步得到的点，而向量就形象的表示了这一过程，(0, 0)至(1, 1)点的向量就是(1 - 0, 1 - 0)，即(1, 1)。向量是一个表示方向和大小的概念，在物理中可以用来表示力和速度。在三维中，点和向量用三元数列表示(x, y, z)，任意一组xyz值可以唯一确定一个点和一个向量。</p><h3 id="二. 变换矩阵">二. 变换矩阵 <a href="#二. 变换矩阵">#</a></h3><p>在图形学中，在做平移，旋转和缩放时，经常会用到矩阵，有缩放矩阵、平移矩阵和旋转矩阵。在三维空间中，变换矩阵都是一个四维矩阵，每一行分别表示x, y, z, w。为什么是四维的而不是三维的呢？请继续往下阅读。</p><h4 id="1. 缩放矩阵（scale）">1. 缩放矩阵（scale） <a href="#1. 缩放矩阵（scale）">#</a></h4><p><img src="https://pengfeiw.github.io/images/blog/13.png" alt="image-20210521105821765"></p><p>上面的公式，左边的第一个操作数（四维矩阵）就是一个缩放矩阵，s1表示x轴的缩放倍数，s2表示y轴的缩放倍数，s3表示z轴的缩放倍数。第二个操作数表示空间中(x, y, z)点， w分量在缩放矩阵中没有用到，我们将其设为1。由右边的结果，可以看出(x, y, z)点经过缩放矩阵变换后，x、y、z分量都各自缩放了s(s1、s2、s3)倍。需要注意的是矩阵的乘法不具有交换律，这里点是用一维列矩阵表示的，作为矩阵乘法的右操作数。如果将其转换到乘法的左边，那么点应该用一维行矩阵表示：</p><p><img src="https://pengfeiw.github.io/images/blog/14.png" alt="image-20210521110937589"></p><p>缩放矩阵比较简单，不需要证明，只需要会简单的乘法，就可以看出x,y,z经过缩放矩阵的变换确实被缩放了。</p><h4 id="2.平移矩阵（translation）">2.平移矩阵（translation） <a href="#2.平移矩阵（translation）">#</a></h4><p><img src="https://pengfeiw.github.io/images/blog/15.png" alt="image-20210521111108645"></p><p>平移矩阵也称位移矩阵，平移矩阵用到了第四列（w列），这也是为什么三维空间变换矩阵为什么是四维的。平移矩阵也比较容易理解，因为可以通过结果看出想x 、y、z确实各自平移了T步。</p><h4 id="3. 旋转矩阵">3. 旋转矩阵 <a href="#3. 旋转矩阵">#</a></h4><p>旋转矩阵，相对难一些，也不是那么容易理解，我们先看最基础的绕x、y、z轴旋转的旋转矩阵。</p><p>沿x轴：</p><p><img src="https://pengfeiw.github.io/images/blog/16.png" alt="image-20210521111545555"></p><p>沿y轴：</p><p><img src="https://pengfeiw.github.io/images/blog/17.png" alt="image-20210521111559180"></p><p>沿z轴：</p><p><img src="https://pengfeiw.github.io/images/blog/18.png" alt="image-20210521111610922"></p><p>引入了三角函数，我们无法从结果看出旋转矩阵是否正确，所以我们需要证明。下面我给出沿z轴旋转的变换矩阵证明过程，其他轴同理可证。</p><p><img src="https://pengfeiw.github.io/images/blog/19.png" alt="image-20210521112417466"></p><p>假设有如图的点p1，因为绕z轴旋转，点的z值是不变的，我们将其设为0，这样可以将其模拟成二维平面xy中旋转。假设p1绕原点旋转b角度，初始角度为a。整个证明过程如下：</p><pre><code>// 经过旋转后向量的长度不变为L(原点到p1和p2的距离相同)
// 由三角函数得到sin(a + b), cos(a + b)的值
cos(a + b) = x2 / L;
sin(a + b) = y2 / L;

// 展开sin(a + b)和cos(a + b)
cos(a) * cos(b) - sin(a) * sin(b) = x2 / L;
sin(a) * cos(b) + cos(a) * sin(b) = y2 / L;

// 用x和y表示cos(a)和sin(a)
x / L * cos(b) - y / L * sin(b) = x2 / L;
y / L * cos(b) + x / L * sin(b) = y2 / L;

// 等式两边同时乘以L
x * cos(b) - y * sin(b) = x2;
y * cos(b) + x * sin(b) = y2;
</code></pre><p>将x2和y2的结果与上面z轴旋转矩阵结果比较，发现是完全一样的。</p><p>按照上面的方法同理可证绕x轴旋转和绕z轴旋转的矩阵。</p><p>那么绕任意轴旋转的矩阵呢？<a href="https://learnopengl-cn.github.io/01%20Getting%20started/07%20Transformations/#_18">learnOpengl_cn官网</a>直接给出了绕任意轴旋转的矩阵，(Rx, Ry, Rz)表示任意轴，θ表示旋转的矩阵。这个矩阵证明比较复杂。</p><p><img src="https://pengfeiw.github.io/images/blog/20.png" alt="image-20210521115236594"></p><p>我就不去给大家证明了，我给出证明的思路，大家可以自己尝试去证明。</p><p>first，我们可以将绕任意轴旋转转换成绕x，y，z轴旋转。所以先将轴(Rx, Ry, Rz)转换成某一个轴，例如转换成z轴。如图将轴绕Y轴旋转θ角度至yz平面。</p><p><img src="https://pengfeiw.github.io/images/blog/21.png" alt="image-20210521115839075"></p><p>在将轴绕x轴旋转a角度至z轴重合。</p><p><img src="https://pengfeiw.github.io/images/blog/22.png" alt="image-20210521120215298"></p><p>现在物体绕该轴旋转，就是绕z轴旋转了。旋转完成后，我们还需要将旋转轴恢复至最初的位置，即将上面的步骤逆操作一遍，先绕x轴旋转-a角度，再按照y轴旋转-θ角度。这一系列变换最后得到的矩阵就是绕任意轴旋转的矩阵。</p><p>（完）。</p></div><div class="markdown-footer"><span class="pre-article"><a href="/blogs/react/mistery-of-react-hook">上一篇：揭开react hook的神秘面纱</a></span><span class="next-article"><a href="/blogs/computer-graphics/3D-matrix-transformation-part-two">下一篇：3D图形学中的矩阵变换（二）</a></span></div></div><div class="toc"><div class="toc-header">目录</div><div class="toc-body"><div class="toc-item"><a class="toc-item-link" href="#3D图形学中的矩阵变换（一）" style="padding-left:15px">3D图形学中的矩阵变换（一）</a></div><div class="toc-item"><a class="toc-item-link" href="#一. 点和向量" style="padding-left:45px">一. 点和向量</a></div><div class="toc-item"><a class="toc-item-link" href="#二. 变换矩阵" style="padding-left:45px">二. 变换矩阵</a></div><div class="toc-item"><a class="toc-item-link" href="#1. 缩放矩阵（scale）" style="padding-left:60px">1. 缩放矩阵（scale）</a></div><div class="toc-item"><a class="toc-item-link" href="#2.平移矩阵（translation）" style="padding-left:60px">2.平移矩阵（translation）</a></div><div class="toc-item"><a class="toc-item-link" href="#3. 旋转矩阵" style="padding-left:60px">3. 旋转矩阵</a></div></div></div></div><div class="footer"><span>@2020-2023 Wang Pengfei</span><a target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index">皖ICP备2021002453号-1</a></div></body></html>