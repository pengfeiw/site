<html lang="zh_cn"><head><title>webgl模拟太阳系动画 | 王鹏飞</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="webgl,3d,solar system,动画,animation,solar,webgl example"><meta name="description" content="使用webgl，模拟绘制太阳系行星天体图。"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous"><link rel="icon" href="/blogs/assests/images/icon.jpg"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="home"><a href="/blogs">Home</a></div><div class="email"><a href="mailto:pengfeixc@sina.com">Email</a></div><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.svg" alt="rss"></a></div></div></div></div><div class="body"><div class="nothing"></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2021年7月14日</span><span class="category"><a href="/blogs/minicode">标签：MiniCode</a></span></div><div class="markdown-body"><h1 id="webgl模拟太阳系">webgl模拟太阳系 <a href="#webgl模拟太阳系">#</a></h1><p>demo: <a href="https://pengfeiw.github.io/minicode/solar-system">minicode——太阳系</a></p><p><img src="https://pengfeiw.github.io/images/blog/88.png" alt="webgl行星"></p><p>这次做的 MiniCode，是用 webgl 模拟太阳系的动画，绘制了太阳系和绕太阳旋转的八颗行星。各个部分的绘制方法我简要概述下。</p><h3 id="1. 背景星空">1. 背景星空 <a href="#1. 背景星空">#</a></h3><p>这部分本来打算采用绘制天空盒的方式，绘制一个无边无际的宇宙的，由于我没有添加自动移动摄像机的功能，所以就简单的绘制了一张背景图片星空。</p><p>需要特别注意的是，绘制背景的时候，一定要预先关闭<strong>深度测试</strong>，绘制好星空背景后再开启<strong>深度测试</strong>，否则由于远近的关系，背景会遮住行星。</p><pre><code class="hljs language-typescript"><span class="hljs-comment">// ---space</span>
spaceShader.<span class="hljs-title function_">useProgram</span>();
gl.<span class="hljs-title function_">bindVertexArray</span>(spaceVao);
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, backgroundTexture);
gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>); <span class="hljs-comment">// 禁用</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>); <span class="hljs-comment">// 开启</span>
</code></pre><p>程序用用到的图片纹理可以在<a href="https://github.com/pengfeiw/solar-system/tree/master/src/solarSystem/image">这里</a>获得。</p><h3 id="2.行星和太阳">2.行星和太阳 <a href="#2.行星和太阳">#</a></h3><p>这部分最难的是计算球体的顶点坐标，在opengl（webgl）中绘制一个曲面，本质上是通过划分成无限个三角形绘制的，只要划分的足够细，我们也就看不出来曲面其实并不是曲面。计算顶点坐标的大概思路如下：</p><ul><li>用多个经纬线划分地球。</li><li>从上至下，用三角函数求每一圈经纬线相交的点。</li><li>经过经纬线划分，此时球面被分割成很多很多的四边形。</li><li>用上面求到的点，分别绘制每个四边形（每个四边形由两个三角形组成）。</li></ul><p>基本算法如上，具体可以参考源码。</p><p>球面绘制的纹理，需要用到纹理坐标和纹理图片，至于球体的纹理坐标思路是通过<a href="https://cgobsession.com/what-is-a-uv-map-and-how-to-create-one/">UV Map</a>计算的，计算过程也是在计算球体顶点坐标同时计算的。</p><p>还需要考虑太阳光照影响，所以需要计算球面每个三角形的顶点的法向量，因为每个绘制的三角形的顶点坐标已经计算了，所以使用向量的叉积很容易计算出法向量。</p><p>计算顶点坐标、顶点法向量和纹理坐标使用的是如下函数，可以在[这里]查看源码。</p><pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getSpherePositions_drawTriangles</span> = (<span class="hljs-params">splitCountH: <span class="hljs-built_in">number</span>, splitCountV: <span class="hljs-built_in">number</span>, radius: <span class="hljs-built_in">number</span></span>) =&gt; {
    ...
    <span class="hljs-keyword">return</span> {vertices, normals, textureCoords};
};
</code></pre><p>函数的三个参数：</p><ul><li>splitCountH: 分割球体的纬线数量（水平线）</li><li>splitCountV: 分割球体的经线数量（竖直线）</li><li>radius: 球体半径</li></ul><h3 id="3. 坐标变换">3. 坐标变换 <a href="#3. 坐标变换">#</a></h3><p>坐标变换，我在之前的文章已经介绍的足够详细了。想要了解可以在我的个人网站查找矩阵变换三篇文章和坐标系讲解的文章。</p><h3 id="4. 附">4. 附 <a href="#4. 附">#</a></h3><p>github源码地址：<a href="https://github.com/pengfeiw/solar-system">https://github.com/pengfeiw/solar-system</a></p><p>(完)</p></div><div class="markdown-footer"><span class="pre-article"><a href="/blogs/computer-graphics/color-and-feng-illumination-model">上一篇：【光照理论】（一）颜色与冯氏光照模型</a></span><span class="next-article"><a href="/blogs/computer-graphics/graphics-material">下一篇：【光照理论】（二）材质</a></span></div></div><div class="toc"><div class="toc-header">目录</div><div class="toc-body"><div class="toc-item"><a class="toc-item-link" href="#webgl模拟太阳系" style="padding-left:15px">webgl模拟太阳系</a></div><div class="toc-item"><a class="toc-item-link" href="#1. 背景星空" style="padding-left:45px">1. 背景星空</a></div><div class="toc-item"><a class="toc-item-link" href="#2.行星和太阳" style="padding-left:45px">2.行星和太阳</a></div><div class="toc-item"><a class="toc-item-link" href="#3. 坐标变换" style="padding-left:45px">3. 坐标变换</a></div><div class="toc-item"><a class="toc-item-link" href="#4. 附" style="padding-left:45px">4. 附</a></div></div></div></div></body></html>