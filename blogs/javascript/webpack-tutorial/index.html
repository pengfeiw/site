<html lang="zh_cn"><head><title></title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords"><meta name="description" content="适用于新手的，简洁易懂的webpack入门教程。"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.png" alt="rss"></a></div></div></div><h1><a href="/blogs/"><img src="https://avatars.githubusercontent.com/u/37898750?s=400&amp;u=33f96e0bbc5bee7a7d1fa8f1eecee9a3d4a6d96c&amp;v=4"></a></h1></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2021年4月19日</span><span class="category"><a href="/blogs/javascript">标签：JavaScript</a></span></div><div class="markdown-body"><h1 id="webpack快速入门2021">webpack快速入门2021 <a href="#webpack快速入门2021">#</a></h1><p>本篇教程适用于webpack初学者。这个也是我自己学习webpack时，整理的一些笔记，适用于新手。 本教程源码地址：<a href="https://github.com/pengfeiw/webpack-tutorial">https://github.com/pengfeiw/webpack-tutorial</a></p><h3 id="一.什么是webpack">一.什么是webpack <a href="#一.什么是webpack">#</a></h3><p>作为一个javascript前端开发者，肯定都知道webpack这个东西，也知道各种各样的<strong>module</strong>。webpack作为一个打包工具，就是将各种各样的模块捆绑（打包）在一起。支持的module有：</p><ul><li>CommonJS</li><li>AMD</li><li>CSS import</li><li>Images url</li><li>Es module</li></ul><p>webpack将所有模块捆绑在一起，使其运行。</p><h3 id="二.重要概念">二.重要概念 <a href="#二.重要概念">#</a></h3><p>首先重点提一下几个相对比较重要也是最常用的东西。</p><h4 id="入口文件（entry point）">入口文件（entry point） <a href="#入口文件（entry point）">#</a></h4><p>webpack工作开始的地方，就是一个js文件。webpack通过这个文件内的import，收集其他模块文件，在通过其他模块文件内的import语句，收集其他依赖，最后将所有模块文件打包到一起，形成一个整体可运行的代码。 默认的入口文件是 <code>src/index.js</code>。</p><h4 id="输出文件（output）">输出文件（output） <a href="#输出文件（output）">#</a></h4><p>output就是webpack通过build过程打包后形成的文件。默认的输出文件夹为根目录下的<code>dist/</code>文件夹。</p><h4 id="加载器（loaders）">加载器（loaders） <a href="#加载器（loaders）">#</a></h4><p>loaders是一些第三方扩展包，可以帮助webpack处理加载各种类型的文件。例如有处理css、image文件的loaders。如果没有loaders，webpack本身是不支持css文件的。</p><h4 id="插件（plugins）">插件（plugins） <a href="#插件（plugins）">#</a></h4><p>plugins也是第三方插件，它可以改变webpack的工作方式，例如有些插件可以设置webpack的环境变量。</p><h4 id="模式（mode）">模式（mode） <a href="#模式（mode）">#</a></h4><p>webpack有两种工作方式：development（开发模式）和production（生产模式）。 主要的区别就是production模式下，产生的捆绑包（文件）更小，去掉了在运行下无关的注释，空格等等。这样可以加快用户加载代码的速度。</p><h3 id="三.实践">三.实践 <a href="#三.实践">#</a></h3><h4 id="1.初始化项目">1.初始化项目 <a href="#1.初始化项目">#</a></h4><p>现在，我们通过实践一步步的了解webpack的工作过程。 首先新建一个目录，并通过<code>npm init -y</code>初始化项目。</p><pre><code class="hljs language-bash"><span class="hljs-built_in">mkdir</span> webpack-tutorial
npm init -y
</code></pre><p>打开刚才创建的package.json，添加如下内容：</p><pre><code class="hljs language-json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack"</span>
<span class="hljs-punctuation">}</span>
</code></pre><p>并安装如下依赖：</p><pre><code class="hljs language-bash">yarn add webpack webpack-cli webpack-dev-server --dev
</code></pre><p>然后执行刚才添加的start命令：</p><pre><code class="hljs language-bash">yarn start
</code></pre><p>运行出错。当我们执行start命令后webpack给我们报错了：<strong>Module not found: Error: Can't reolve './src'</strong> 。 不用怕，还记得我们之前提到的<strong>入口文件</strong>吗，这个错误产生的原因就是没有找到入口文件。我们只要添加入口文件就可以了。创建src文件夹，并在src文件夹下添加index.js文件，输入以下内容：</p><pre><code class="hljs language-javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"webpack is so easy"</span>);
</code></pre><p>然后再次执行start命令，可以看到webpack正常运行，并生成了一个dist文件夹，dist文件就是webpack的输出文件，入口文件和输出文件的位置都是可以通过配置更改的。 因为我们的start命令，没有指定webpack的mode，所以webpack将以production模式运行。我们修改start命令，将模式改为development，修改package.json中的start命令：</p><pre><code class="hljs language-json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack --mode development"</span>
<span class="hljs-punctuation">}</span>
</code></pre><p>再次运行start命令，webpack将以development模式运行。</p><h4 id="2.webpack配置文件，指定输入输出">2.webpack配置文件，指定输入输出 <a href="#2.webpack配置文件，指定输入输出">#</a></h4><p>前面提到，我们可以更改webpack的配置的。为了配置webpack，我们需要在根目录创建一个<strong>webpack.config.js</strong>文件。这是一个js文件，所以我们可以在里面写任意可运行的js代码。 首先更改入口文件和出口文件：</p><pre><code class="hljs language-javascript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-comment">// 将入口文件指定为main.js</span>
    <span class="hljs-attr">entry</span>: {<span class="hljs-attr">index</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"src"</span>, <span class="hljs-string">"main.js"</span>)},
    <span class="hljs-comment">// 将输出文件目录改为build/</span>
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"build"</span>)
    }
};
</code></pre><p><strong>entry</strong>字段可以用来修改入口文件，上面的代码将webpack入口文件改为<code>src/main.js</code>。<strong>output</strong>字段用于修改输出文件位置，我们将输出文件目录改为<code>build/</code>。将src目录下的<code>index.js</code>文件重命名为<code>main.js</code>，运行<strong>start</strong>命令，可以看到webpack输出目录build。</p><h4 id="3.添加html页面">3.添加html页面 <a href="#3.添加html页面">#</a></h4><p>为了将webpack打包后的文件，用script标签嵌入到html文档中，我们需要借助第三方plugins扩展：<strong>html-webpack-plugin</strong> 。上面介绍过plugin，<strong>plugin是改变webpack工作方式的第三方扩展</strong>。<strong>html-webpack-plugin</strong>的作用就是改变webpack的工作方式，使webpack可以将打包后的js文件，添加到html页面的<code>&lt;script&gt;</code>标签中，这样打开html，就可以运行我们的js脚本。 首先，安装插件：</p><pre><code class="hljs language-bash">yarn add html-webpack-plugin --dev
</code></pre><p>然后，更改webpack.config.js文件：</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"html-webpack-plugin"</span>);
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
            <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"public"</span>, <span class="hljs-string">"index.html"</span>)
        })
    ]    
}
</code></pre><p>上面的代码指示webpack加载<code>public/index.html</code>，所以创建public目录，并添加index.html文件，内容如下：</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>webpack tutorial<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>webpack tutorial<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><p>运行<code>yarn start</code>，查看结果。此时我们的<code>build</code>目录下会出现一个index.html文件，文件内容如下：</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>webpack tutorial<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>webpack tutorial<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><p>与原html文件相比，增加了一个<code>&lt;script&gt;</code>标签，标签内容就是webpack打包后的js文件。</p><p>所以，我们可以知道html-webpack-plugin的功能：</p><ol><li>加载html文件。</li><li>将webpack打包后的js文件，通过script标签添加到html文件中。</li></ol><h4 id="4.通过webpack启动本地服务">4.通过webpack启动本地服务 <a href="#4.通过webpack启动本地服务">#</a></h4><p>作为开发者，肯定会用到本地服务，webpack提供了development server，可以很方便的启动一个本地服务，方便开发者进行开发工作。 首先我们需要安装<strong>webpack-dev-server</strong>包。</p><pre><code class="hljs language-bash">yarn add webpack-dev-server --dev
</code></pre><p>细心的朋友已经注意到，我在安装这些ku的时候都会添加<code>--dev</code>字段，表示这些包只在开发模式中使用，方便开发工作的，在生产环境下并没有作用。 安装了这个包，是可以直接使用，首先我们更改<code>package.json</code>中的命令如下：</p><pre><code class="hljs language-json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"buildDev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack --mode development"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack serve --mode development"</span>
<span class="hljs-punctuation">}</span>
</code></pre><p>更改后，打包命令改为<code>buildDev</code>，启动本地服务器命令为<code>start</code>。执行<code>yarn start</code>。会在本地8080端口启动一个本地服务。打开<a href="http://localhost:8080/">http://localhost:8080</a>，会显示index.html页面。</p><h4 id="5.加载css">5.加载css <a href="#5.加载css">#</a></h4><p>为了加载css，我们需要用到<strong>webpack loaders</strong>。<strong>webpack loaders</strong>是为了处理各种各样的模块和文件。为了加载css文件，我们需要安装至少如下两个loaders:</p><ul><li><strong>css-loader</strong>: 让我们可以使用import语句导入css文件。</li><li><strong>style-loader</strong>: 将css样式插入到html dom中。</li></ul><p>安装：</p><pre><code class="hljs language-bash">yarn add css-loader --dev
yarn add style-loader --dev
</code></pre><p>配置webpack.config.js，我们需要添加module字段，并增加rules, module表示该插件处理的是各种模块文件（ts、css、less等），rules对应不同的文件类型使用不同的loaders。</p><pre><code class="hljs language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">module</span>: {
        <span class="hljs-attr">rules</span>: [
            {
                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
                <span class="hljs-attr">use</span>: [<span class="hljs-string">"style-loader"</span>, <span class="hljs-string">"css-loader"</span>]
            }
        ]
    }
}
</code></pre><p>为了测试loaders是否起作用，我们在src目录下增加<code>style.css</code>文件：</p><pre><code class="hljs language-css"><span class="hljs-selector-tag">span</span> {
    <span class="hljs-attribute">color</span>: green;
}
</code></pre><p>更改<code>main.js</code>文件，导入<code>style.css</code>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">"./style.css"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"webpack is so easy."</span>);
</code></pre><p>启动webpack server服务，打开<a href="http://localhost:8080">localhost:8080</a>，可以看到我们的字变成了绿色，表示成功加载了css文件。 <img src="https://pengfeiw.github.io/images/blog/8.jpg" alt=""></p><p><strong>注意：loaders的顺序很重要，webpack加载loaders的顺序是从右到左，所以下面的loaders配置是无效的：</strong></p><pre><code class="hljs language-javascript"><span class="hljs-attr">use</span>: [<span class="hljs-string">"css-loader"</span>, <span class="hljs-string">"style-loader"</span>]
</code></pre><p>因为style-loader负责将样式插入到html中，程序总是先执行js代码，所以首先执行的是css的import，所以顺序错误了。</p><p>同样，我们可以增加SASS文件，只需要增加<strong>sass-loader</strong>，这个留着大家后面自己尝试。</p><h4 id="6.加载es modules">6.加载es modules <a href="#6.加载es modules">#</a></h4><p><strong>webpack最重要的功能就是加载es modules</strong>。到这里大家应该知道加载es modules，我们应该也需要增加对应的loaders，但是其实webpack已经自带了加载es modules的功能。我们可以直接使用。新建<code>src/component.js</code>文件，写入以下代码：</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">print</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"this is component.js"</span>);
}
</code></pre><p>然后更改<code>src/main.js</code>:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">"./style.css"</span>;
<span class="hljs-keyword">import</span> {print} <span class="hljs-keyword">from</span> <span class="hljs-string">"./component"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"webpack is so easy."</span>);
<span class="hljs-title function_">print</span>();
</code></pre><p>启动服务，打开浏览器控制台，有如下输出，表示webpack es modules正常加载。</p><p><img src="https://pengfeiw.github.io/images/blog/9.jpg" alt=""></p><h4 id="7.production模式">7.production模式 <a href="#7.production模式">#</a></h4><p>前面说过webpack有两种模式：development和production模式。我们可以指定webpack打包的方式，修改package.json的scripts字段：</p><pre><code class="hljs language-json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"buildDev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack --mode development"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack --mode production"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack serve --mode development"</span>
<span class="hljs-punctuation">}</span>
</code></pre><p>执行build命令，打包后的文件会删除冗余的注释和空格用于部署到生产环境。</p><p>这个教程，内容并不多，大概一个小时就可以学完，目的是为了介绍webpack的一些基本概念。webpack内容比较多，遇到问题可以查看<a href="https://www.webpackjs.com/">官方文档</a>和百度，在实践中慢慢熟悉和学习。</p><p>（完）</p></div><div class="markdown-footer"><span class="pre-article"><a href="/blogs/algorithm-math/binaryTree-traverse">上一篇：二叉树—已知二叉树的前序遍历和中序遍历，输出二叉树</a></span><span class="next-article"><a href="/blogs/javascript/miracle-canvas">下一篇：（miracle-canvas）增强Html canvas的功能</a></span></div></div></body></html>