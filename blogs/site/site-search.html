<html lang="zh_cn"><head><title>站内搜索功能的几种实现方式</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords"><meta name="description" content="通过谷歌自定义搜索引擎、必应自定义搜索引擎、Lrnu等方式实现站内搜索功能。"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><link rel="icon" href="/blogs/assests/images/icon.jpg"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="email"><a href="mailto:pengfeixc@sina.com">Email</a></div><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.svg" alt="rss"></a></div></div></div><a href="/blogs/"><img src="/blogs/assests/images/icon.jpg"></a></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2021年9月27日</span><span class="category"><a href="/blogs/site">标签：其他</a></span></div><div class="markdown-body"><h1 id="站内搜索功能的几种实现方式">站内搜索功能的几种实现方式 <a href="#站内搜索功能的几种实现方式">#</a></h1><p>今天花了一些时间优化了网站的搜索功能。</p><h2 id="一.简易版搜索">一.简易版搜索 <a href="#一.简易版搜索">#</a></h2><p>之前的网站搜索功能实现比较简单。过程大致如下：</p><ul><li>用户在搜索框输入要搜索的关键字。</li><li>浏览器根据关键字，发送搜索请求。</li><li>服务器收到请求。</li><li>服务器根据搜索关键字，查询数据库（根据文章标题和文章描述），将查到的文章返回给浏览器。</li><li>浏览器根据请求response，渲染文章列表。</li></ul><p>由于这个搜索功能只考虑了文章的标题和描述，没有搜索文章的内容，功能很弱，无法满足一般的搜索需求，所以一直计划着改进这个搜索功能。接下来的内容，都是我在尝试改进的过程中查找到的资料，在这里分享给大家。</p><h2 id="二.两个Library">二.两个Library <a href="#二.两个Library">#</a></h2><h3 id="%3Ca%20href=%22https://lunrjs.com/%22%3ELunrJs%3C/a%3E"><a href="https://lunrjs.com/">LunrJs</a> <a href="#%3Ca%20href=%22https://lunrjs.com/%22%3ELunrJs%3C/a%3E">#</a></h3><p><a href="https://lunrjs.com/">LunrJs</a>是一个用于浏览器的小型全文搜索库。</p><p>可以通过npm安装。</p><pre><code class="hljs language-shell">npm install lunr
</code></pre><p>也可以通过<code>script</code>嵌入到页面中。</p><pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/lunr/lunr.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre><p>使用方式如下。</p><ol><li>创建index。</li></ol><p>准备搜索的<code>documents</code>参数。</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> documents = [{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Lunr"</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"Like Solr, but much smaller, and not as bright."</span>
    }, {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"React"</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"A JavaScript library for building user interfaces."</span>
    }, {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Lodash"</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"A modern JavaScript utility library delivering modularity, performance &amp; extras."</span>
}]
</code></pre><p>使用<code>documents</code>创建index，想要在<code>text</code>字段中搜索，<code>name</code>是标识符。</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> idx = <span class="hljs-title function_">lunr</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">ref</span>(<span class="hljs-string">'name'</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">field</span>(<span class="hljs-string">'text'</span>)

    documents.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">doc</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>(doc)
    }, <span class="hljs-variable language_">this</span>)
})
</code></pre><ol start="2"><li>搜索关键字。</li></ol><pre><code class="hljs language-javascript">idx.<span class="hljs-title function_">search</span>(<span class="hljs-string">"bright"</span>);
</code></pre><ol start="3"><li>搜索结果。</li></ol><pre><code class="hljs language-javascript">[
    {
        <span class="hljs-string">"ref"</span>: <span class="hljs-string">"Lunr"</span>,
        <span class="hljs-string">"score"</span>: <span class="hljs-number">1.136</span>,
        <span class="hljs-string">"matchData"</span>: {
            <span class="hljs-string">"metadata"</span>: {
                <span class="hljs-string">"bright"</span>: {
                    <span class="hljs-string">"text"</span>: {}
                }
            }
        }
    }
]
</code></pre><p><code>ref</code>表示创建index时的标识符。<code>score</code>表示分数，表示该页面的匹配程度，分数越高，匹配度越高。<code>matchData</code>表示匹配的数据。</p><p>使用Lunr，完全可以满足网站内部的搜索，感兴趣的可以试试。</p><h2 id="三.自定义Search Engine">三.自定义Search Engine <a href="#三.自定义Search Engine">#</a></h2><p>一些机构提供了自定义搜索引擎的界面，可以嵌入到网站内使用，有付费的也有免费的。下面我介绍两个比较好且免费的，谷歌和bing。</p><h3 id="google自定义搜索引擎">google自定义搜索引擎 <a href="#google自定义搜索引擎">#</a></h3><p><a href="https://programmablesearchengine.google.com/about/">google Programmable Search Engine</a>，谷歌提供的可以免费使用的自定义搜索引擎。</p><p>优点自然不用说，就是将谷歌搜索引擎嵌入到网站内部，可以限定搜索内容的范围，例如限定在本网站。下面是我使用google自定义搜索引擎搜索本站内容下的页面，搜索关键字为typescirpt。</p><p><img src="https://pengfeiw.github.io/images/blog/140.jpg" alt="google Programmable Search Engine"></p><p>缺点就是有墙，需要vpn翻墙。</p><p>所以很可惜，因为需要梯子，我放弃了google搜索引擎。希望能有一天可以不用vpn也能用上google搜索吧。</p><h3 id="bing自定义搜索引擎">bing自定义搜索引擎 <a href="#bing自定义搜索引擎">#</a></h3><p>必应也提供了自定义搜索引擎，与google的功能差不多，界面也可以完全自定义，而且不需要翻墙哦。</p><p>戳<a href="https://www.microsoft.com/en-us/bing/apis/bing-custom-search-api">这里</a>进入官方页面。微软也提供了使用教程，请戳<a href="https://docs.microsoft.com/en-us/azure/cognitive-services/bing-custom-search/tutorials/custom-search-web-page#:~:text=To%20create%20a%20Bing%20Custom%20Search%20instance%3A%201,content%20the%20search%20returns%20...%20More%20items%20">这里</a>。</p><p>下图是我试用，bing自定义搜索引擎，搜索我的网站下的内容截图。</p><p><img src="https://pengfeiw.github.io/images/blog/141.jpg" alt="bing custom search engine"></p><p>按照官方教程，自定义完成后，可以嵌入到个人网站内，免费使用，十分方便。</p><p>但是使用此功能，需要订阅<a href="https://portal.azure.com/#home">Azure</a>的服务，虽然是免费的，但是订阅时，需要提供外汇银行卡。所以想要使用bing自定义搜索引擎，要提前办一张visa卡哦。</p><h2 id="四.最简单的方法">四.最简单的方法 <a href="#四.最简单的方法">#</a></h2><p>最简单的方法，就是直接利用<a href="https://www.baidu.com">google</a>、<a href="https://www.bing.com">bing</a>和<a href="https://www.baidu.com">百度</a>的浏览器搜索功能。</p><p>这也是目前（2021年09月27日）我选择的方式，我选择的是bing。这里主要是利用到一个技巧，当我们使用bing搜索时，可以限定搜索某个域名下的内容。例如在我的网站内搜索"typescript"时，可以在浏览器搜索框输入以下文字。</p><pre><code>typescript site: pengfeixc.com
</code></pre><p>以下是我用bing搜索的图片。</p><p><img src="https://pengfeiw.github.io/images/blog/142.jpg" alt="bing search results"></p><p>所以，只需要在网站内部，跳转到bing，并且指定搜索内容就可以了。</p><p>可以通过search api指定query字符串的方式，<a href="https://docs.microsoft.com/en-us/bing/search-apis/bing-custom-search/reference/query-parameters">这里</a>列出了所有查询字符串参数。</p><p>参考文档，使用以下格式的url就可以打开bing搜索，在指定域名下查询指定内容。</p><pre><code>https://bing.com/search?q=&lt;查找的内容&gt;%20site%3A+&lt;指定的域名&gt;
</code></pre><p>其中<code>%20</code>和<code>%3A</code>是html编码，因为url地址栏不支持特殊字符。戳<a href="https://krypted.com/utilities/html-encoding-reference/">这里</a>查看html编码字符。</p><p>希望，以上内容可以帮到大家。</p><p>（完）</p></div><div class="markdown-footer"><span class="pre-article"><a href="/blogs/css/pure-css-hover-animation">上一篇：一些超酷的css特效</a></span><span class="next-article"><a href="/blogs/javascript/typescript-declarations">下一篇：TypeScript类型声明完全指南</a></span></div></div></body></html>