<html lang="zh_cn"><head><title>网站加载慢，怎么解决? | 王鹏飞</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords"><meta name="description" content="网页有大量的图片展示时，网页打开速度慢，作为开发者应该从哪些方向解决优化。"><link rel="stylesheet" href="/blogs/assests/code_github.css"><link rel="stylesheet" href="/blogs/assests/github_markdown.css"><link rel="stylesheet" href="/blogs/assests/article.css"><link rel="stylesheet" href="/blogs/assests/navigator.css"><link rel="icon" href="/blogs/assests/images/icon.jpg"><meta property="author" content="王鹏飞"><script type="text/javascript">window.addEventListener("DOMContentLoaded",function(){document.getElementById("search-input").addEventListener("search",e=>{e.target.value&&window.open(`https://bing.com/search?q=${e.target.value}%20site%3A+pengfeixc.com`,"_blank")})})</script></head><body><div class="header"><div class="navigator"><div class="links"><div class="home"><a href="`${root}`">Home</a></div><div class="email"><a href="mailto:pengfeixc@sina.com">Email</a></div><div class="github"><a target="_blank" href="https://github.com/pengfeiw">GitHub</a></div><div clss="minicode"><a target="_blank" href="https://pengfeiw.github.io/minicode">MiniCode</a></div><div class="search"><input id="search-input" type="search" placeholder="search"></div><div class="rss"><a href="/blogs/rss.xml"><img src="/blogs/assests/images/rss.svg" alt="rss"></a></div></div></div></div><div class="markdown"><div class="markdown-header"><span class="date">日期：2023年9月17日</span><span class="category"><a href="/blogs/site">标签：其他</a></span></div><div class="markdown-body"><h1 id="网站加载慢，怎么解决？">网站加载慢，怎么解决？ <a href="#网站加载慢，怎么解决？">#</a></h1><p>这篇文章是站在开发者（我）的角度的，介绍我开发了一个网站，由于网站首页图片资源众多且图片较大，导致首页加载缓慢，我是如何处理的。</p><h2 id="帮我写个网站吧">帮我写个网站吧 <a href="#帮我写个网站吧">#</a></h2><p>最近帮一个朋友写了个网站：<a href="https://tangweijuan.com">https://tangweijuan.com</a>，这个网站是部署在 github page 上的</p><p><img src="../static/images/4.jpg" alt="唐维娟的个人网站"></p><p>作为一个设计师，平时比较喜欢画画，所以网站主页面存在大量的图片资源，当用户打开主页时，一次性加载如此多的<strong>高清图片</strong>资源，网页打开的速度是非常慢的。</p><p>那么如何解决呢？</p><h2 id="加速">加速 <a href="#加速">#</a></h2><ol><li>图片懒加载</li></ol><p>首先立刻从图片出发，让首页图片(懒加载)[<a href="https://web.dev/lazy-loading-images/%5D%EF%BC%8Cimg">https://web.dev/lazy-loading-images/]，img</a> 元素可以设置 <code>loading="lazy"</code> 属性表示该图片具有懒加载的功能，但是并不是所有浏览器都支持该属性，<a href="https://caniuse.com/?search=img%20lazy%20load">点击查看</a>：</p><p><img src="../static/images/5.jpg" alt="loading=&quot;lazy&quot; 支持度"></p><p>所以需要自己实现图片懒加载或者用一些相关的库。</p><ol start="2"><li>添加模糊图片、压缩图片</li></ol><p>用了懒加载之后，由于原图还是过大，导致屏幕图片占位空白时间较长，经常浏览网页的朋友，应该知道，我们可以添加一张模糊的图片（很小很小的图片）用来高清图片加载前的展示占位。</p><p><img src="../static/images/6.jpg" alt="图片懒加载"></p><p>当然，我们不可能每次用软件生成模糊图片，得自动化，用程序去处理，每次提交图片后，程序能够自动生成对应的模糊图片。这个功能可以借助 <a href="https://github.com/joe-bell/plaiceholder#readme">plaiceholder</a> 实现，它是一个 nodejs 库，专门用来生成模糊图片的。</p><pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">generateLowQualityImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">imgSrc: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFile</span>(imgSrc);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPlaiceholder</span>(buffer, { <span class="hljs-attr">size</span>: <span class="hljs-number">10</span>});
};
</code></pre><p>但是由于网页部署在 github page 上，国内访问速度一般都很感人，而且原高清图片太大了，所以不得不压缩图片，使用 <a href="https://github.com/lovell/sharp">sharp</a> 可以达到我的目的。</p><pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">minifyImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">imgSrc</span>) =&gt; {
    <span class="hljs-keyword">const</span> image = <span class="hljs-title function_">sharp</span>(imgSrc);
    <span class="hljs-keyword">await</span> image.<span class="hljs-title function_">resize</span>({
        <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>
    }).<span class="hljs-title function_">toFormat</span>(<span class="hljs-string">"jpeg"</span>, { <span class="hljs-attr">mozjpeg</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">quality</span>: <span class="hljs-number">80</span>});
}
</code></pre><ol start="3"><li>免费 CDN “加速”</li></ol><p>最后可以使用 <a href="https://www.cloudflare.com/">Cloudflare</a> 免费版进行 CDN “加速”，因为我用的免费版，所以效果貌似并不是很好，感兴趣的可以在网上搜一搜相关的教程。</p><h2 id="结果">结果 <a href="#结果">#</a></h2><p>经过上面的操作，网站主页的速度比之前快了很多。</p><p><img src="../static/images/7.jpg" alt="网站测速"></p><p>（完）</p></div><div class="markdown-footer"><span class="next-article"><a href="/blogs/developer-handbook/first-use-github-ssh-deploykey">下一篇：初次使用 Github 的 SSH deployKey</a></span></div></div><div class="footer">@2020-2023 Wang Pengfei</div></body></html>